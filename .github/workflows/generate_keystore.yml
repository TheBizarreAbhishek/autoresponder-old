name: Generate Keystore

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Generate Release Keystore
      run: |
        keytool -genkey -v \
          -keystore app/release.keystore \
          -alias release \
          -keyalg RSA \
          -keysize 2048 \
          -validity 10000 \
          -storepass '${{ secrets.KEYSTORE_PASSWORD }}' \
          -keypass '${{ secrets.KEY_PASSWORD }}' \
          -dname "CN=Abhishek Babu, OU=Development, O=TheBizarreAbhishek, L=Unknown, ST=Unknown, C=IN"
    
    - name: Configure Git
      run: |
        git config user.name "Abhishek Babu"
        git config user.email "thebizarreabhishek@users.noreply.github.com"
    
    - name: Commit Keystore
      run: |
        git add app/release.keystore
        git commit -m "Add release keystore for APK signing"
        git push
